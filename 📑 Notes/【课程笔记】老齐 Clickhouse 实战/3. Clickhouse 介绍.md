
## Clickhouse 概述
ClickHouse 是由 Yandex 开发的一款**开源列式数据库管理系统（Column-Oriented DBMS）**，专为在线分析处理（OLAP）设计，具备**高性能、大数据量、高压缩比、实时分析**等特点。

| 特性                 | 简要说明                                          |
| ------------------ | --------------------------------------------- |
| **列式存储**           | 数据按列而非按行存储，便于压缩和向量化计算，适合分析型查询。                |
| **极致性能**           | 支持大数据量的实时查询，采用向量化执行引擎、并行计算、多线程等优化。            |
| **SQL支持**          | 支持类标准 SQL 语法，学习成本较低。                          |
| **高压缩比**           | 由于列式结构，支持多种压缩算法（如 LZ4），大大节省存储空间。              |
| **可水平扩展**          | 支持分布式部署，可处理 PB 级数据，适合企业级需求。                   |
| **支持物化视图、TTL、表引擎** | 如 MergeTree、ReplacingMergeTree 等引擎，为不同场景定制优化。 |
## 发展历程

### MySQL 时期

Yandex 内部使用 Metrica 系统进行流量分析，例如分析使用者的设备、地域分布等。Metrica 最初采用 MySQL 方案，使用 MyISAM 表引擎。这类分析场景更关注数据的写入和查询性能，不关心事务操作（MyISAM 表引擎不支持事务特性），相比 InnoDB 表引擎，[[MyISAM]] 表引擎在分析场景中由更好的性能。
MyISAM 表引擎使用 B+树结构存储索引，数据使用单独的存储文件。单线程的理想场景下，数据可以被按顺序的一次写入磁盘，但是现实场景往往复杂得多。用于流量分析的数据信息由站点SDK实时采集后发送到远端的接收系统，而这个接收系统实际上是一个分布式系统，它们会并行、随机的将数据写入 MySQL 集群，从而导致数据在磁盘的存储是完全随机的。由于无法保证顺序存储，因此 MySQL 的查询性能大大降低，因此这套技术方案随着时间的推移、数据的膨胀以后变得无法适用。

### Metrage 时期

由于 MySQL 的在大数据量下的性能问题，Yandex 自研了全新的系统名为 Metrage。
- 数据层面：采用了 Key-Value 键值对模型代替原有的关系型数据库。
- 索引层面：使用 [[LSM树]]代替 [[B+树]]，预先在内存构建小树，到一定量再整体写入磁盘，从而保证磁盘文件的局部有序性。
- 数据处理：实时查询方式改为了预处理的方式，提升查询速度。
Metrage 为 Yandex.Metrica 的查询性能带来了革命性提升，对于固定查询的场景（即实现确定需要进行怎样的维度组合，从而进行数据聚合预处理）查询性能由原有的26秒缩短到了1秒内。
缺陷：对维度组合进行预处理会随着唯独数量的提升引发指数级的数据膨胀。
### OLAPServer 时期

Yandex.Metrica 产品初期只能支持固定报表的查询分析功能， 随着时间的推移，这种固定的分析方式已经无法满足用户的诉求，因此 Metrica 需要支持自定义分析报告的功能，但是原有的这种架构无法支持这种需求，于是有了后续研发的 OLAPServer 系统。
OLAPServer被设计为专门处理自定义报告的这类临时性分析需求的系统，本身并不是一个完备的数据库，而是和 Metrage 形成互补的关系。在设计上，它的数据模型又换回了关系型数据，因为相比 K-V 模型，关系型数据库可以具备更好的数据描述能力，同时使用 SQL 作为查询语言可以有更好的群众基础。在数据存储方面，和 MyISAM 同样分为了索引文件和数据文件分离存储，但是在索引方面并没有完全使用 LSM 树，而是只是借鉴了 LSM 树的稀疏索引，同时在数据文件的设计上沿用了 LSM 的数据段思想，即一个数据段内的数据能保证有序，借助稀疏索引去定位数据段，同时引入了列式存储的思想，每个列字段独立存储，从而进一步减少数据读取的范围。它是如前所述，它本质上并不是一个完备的数据库，因为它的定位就是为了弥补自定义维度分析的一个专用系统，所以设计上只有一种固定长度数据类型，没有 DBMS 的一些基本管理功能。

### ClickHouse 时期

在 OLAPServer 基础上进行完善，以实现一个完整的 DBMS 系统为目标，最终打造出 ClickHouse，并于 2016 年开源。
ClickHouse 的名称源于 `Click Stream，Data WareHouse` ，意思是一次点击事件流，面向数据仓库进行 OLAP 分析。
在今天， ClickHoue 能够被用于各种数据分析类场景中，被广泛应用于广告、Web、电信、金融、网络游戏等业务中。
CilckHouse 不适用的场景：
- 不支持事务
- 不擅长根据主键按行粒度进行查询或删除（虽然支持），因此不应被当做 KV 数据库去使用。
 